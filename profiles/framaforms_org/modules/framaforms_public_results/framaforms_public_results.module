<?php



/**
* Add specific views access if the visitor is the author of the node
*/
function framaforms_public_results_views_access_callbacks() {
  return array(
    'framaforms_public_results_user_has_access' => t('Form author has checked the "public results" option'),
  );
}

function framaforms_public_results_user_has_access($account = NULL) {
  // get node id
  $tmp_nid = arg(1);
  $tmp_node = node_load($tmp_nid);

if (isset($tmp_node->field_form1_results_public['und'])) { // test if component exists first (it has been added after so it could not exists
   if ($tmp_node->field_form1_results_public['und'][0]['value']==true) {    // Author has checked the option to give public access

    

     return TRUE;
   }
   return false;
  }
}

function framaforms_public_results_webform_submission_actions($node, $submission) {
  if (webform_results_access($node)) {
    $actions['myaction'] = array(
      'title' => t('Back to results'), 
      'href' => 'node/' . $node->nid . '/webform-results/table', 
      'query' => '',

//      'href' => 'node/' . $node->nid . '/submission/' . $submission->sid . '/myaction', 
//      'query' => drupal_get_destination(),
    );
  }

  return $actions;
}